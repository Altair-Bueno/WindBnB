---
import { ViviendaApi } from "../../../api/A2viviendasREST/apis";
import WindbnbLayout from "../../../layouts/WindbnbLayout.astro";
import CloudinaryEdit from "../../../components/CloudinaryEdit.svelte";
import AppConfig from "../../../config";
import {
  Configuration as ViviendaConfiguration,
  Vivienda,
} from "../../../api/A2viviendasREST";

const { idCasa } = Astro.params as { idCasa: string };
const viviendaApi = new ViviendaApi(
  new ViviendaConfiguration(AppConfig.viviendas)
);

let viv: Vivienda;

try {
  viv = await viviendaApi.getHouseById({ idCasa });
} catch (error) {
  return Astro.redirect(
    "/?" + new URLSearchParams({ danger: "Cant find house with that ID" })
  );
}

const loc = viv?.location;
const loc_splitted = loc.split(", ");
---

<WindbnbLayout title="Edit house">
  <CloudinaryEdit
    cloudName={import.meta.env.CLOUDINARY_CLOUD_NAME}
    uploadPreset={import.meta.env.CLOUDINARY_UPLOAD_PRESET}
    vivienda={viv}
    client:load
  />
</WindbnbLayout>
